#version 330

// Default color buffer location is 0
// If you create framebuffer your own, you need to take care of it
layout(location=0) out vec4 color;
layout(location=1) out vec4 vDoF;

in vec2 fTexcoord;
in vec3 fNormal;
in vec3 fragPos;
in float fDepth;

uniform float ambientStrength;
uniform vec3 lightPos;
uniform vec3 viewPos;
uniform vec3 lightColor;
uniform sampler2D uSampler;

uniform float focalLen ;
uniform float Dlens ;
uniform float focusDis ;

float maxCoC = 1;
float scale = 100;
float sceneRange = 100;
float snesorHeight = 0.024f;

void main()
{
	
	//float pixCoC = abs(Dlens * focalLen * (focusDis - fDepth) / (focusDis * (fDepth - focalLen)));
    float pixCoC = abs(Dlens * focalLen * (fDepth/100 - focusDis) / (fDepth/100 * (focusDis - focalLen)));
    //float blur = clamp(pixCoC * scale/ maxCoC , 0.0, 1.0);
	
	// put Coc into a % of the image sensor height
	float percentOfSensor = pixCoC/snesorHeight;
    
	//artificially clam % between 0 and max CoC
	float  blur = clamp(percentOfSensor,0.0f,maxCoC);
	
	vDoF = vec4(fDepth / sceneRange / 100, blur*10, 0.0, 0.0); 
	
	
    color = texture(uSampler, fTexcoord);
}
